generator client {
    provider = "prisma-client"
    output   = "../generated/prisma"
}

datasource db {
    provider = "postgresql"
}

enum UserRole {
    ADMIN
    USER
    HOST
    VENDOR
    GUIDE
}

enum Gender {
    MALE
    FEMALE
    OTHER
}

enum AuthProvider {
    OTP
    PASSWORD
    GOOGLE
}

enum ProviderStatus {
    PENDING
    ACTIVE
    SUSPENDED
    NOT_ACTIVE
}

enum ProviderType {
    TOUR_VENDOR
    ACTIVITY_VENDOR
    HOMESTAY_HOST
    VEHICLE_PARTNER
    LOCAL_GUIDE
}

enum ProductType {
    TOUR
    ACTIVITY
    HOMESTAY
    VEHICLE
    LOCAL_GUIDE
}

enum BookingSource {
    ONLINE
    OFFLINE
}

enum BookingStatus {
    REQUESTED
    REJECTED
    AWAITING_PAYMENT
    CONFIRMED
    CANCELLED
    COMPLETED
    REFUNDED
}

enum VehicleType {
    BIKE
    SCOOTY
    CAR
    SUV
    TEMPO
}

enum VehicleBookingMode {
    SELF_DRIVE
    WITH_DRIVER
}

enum PaymentProvider {
    RAZORPAY
    STRIPE
}

enum PaymentStatus {
    CREATED
    AUTHORIZED
    CAPTURED
    FAILED
    REFUNDED
}

enum PermitStatus {
    REQUIRED
    COLLECTING_DOCS
    SUBMITTED
    APPROVED
    REJECTED
    EXPIRED
}

enum PermitDocumentType {
    PASSPORT_PHOTO
    ID_PROOF
    SIGNATURE
}

enum ReviewTarget {
    TOUR
    ACTIVITY
    HOMESTAY
    VEHICLE
    LOCAL_GUIDE
}

enum RefundStatus {
    INITIATED
    PROCESSED
    FAILED
}

enum PayoutStatus {
    PENDING
    PAID
    FAILED
}

enum MethodEnum {
    CARD
    UPI
    NETBANKING
    WALLET
}

enum BucketListStatus {
    DRAFT
    PENDING_CHECKOUT
    CONVERTED_TO_BOOKING
    EXPIRED
}

enum ServiceType {
    TOUR_BOOKING
    HOMESTAY_BOOKING
    VEHICLE_BOOKING
    LOCAL_GUIDE_BOOKING
    ACTIVITY_BOOKING
}

model Address {
    id         String                                @id @default(uuid())
    street     String?
    city       String
    state      String
    country    String                                @default("India")
    postalCode String?
    latitude   Float
    longitude  Float
    location   Unsupported("geography(Point,4326)")?

    tours       Tour[]
    homestays   Homestay[]
    pois        POI[]
    vehicles    Vehicle[]
    localGuides LocalGuide[]

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
}

model POI {
    id          String   @id @default(uuid())
    name        String
    description String?
    specialty   String[]
    imageUrls   String[]
    latitude    Float
    longitude   Float
    address     Address? @relation(fields: [addressId], references: [id])
    addressId   String?

    tourItineraryItems TourItineraryPOI[]

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
}

model BucketList {
    id        String           @id @default(uuid())
    userId    String
    tripName  String?
    status    BucketListStatus @default(DRAFT)
    user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
    items     BucketListItem[]
    createdAt DateTime         @default(now()) @map("created_at")
    updatedAt DateTime         @default(now()) @updatedAt @map("updated_at")

    @@index([userId, status])
}

model BucketListItem {
    id           String      @id @default(uuid())
    bucketListId String
    productType  ProductType
    productId    String
    quantity     Int         @default(1)
    startDate    DateTime?
    endDate      DateTime?
    metadata     Json?
    bucketList   BucketList  @relation(fields: [bucketListId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now()) @map("created_at")
}

model Vehicle {
    id              String               @id @default(uuid())
    name            String
    type            VehicleType
    brand           String?
    model           String?
    registrationNo  String               @unique
    imageUrls       String[]
    basePricePerDay Int
    bookingMode     VehicleBookingMode[]
    isActive        Boolean              @default(true)
    providerId      String
    provider        Provider             @relation(fields: [providerId], references: [id])
    address         Address?             @relation(fields: [addressId], references: [id])
    addressId       String?

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
}

model LocalGuide {
    id              String   @id @default(uuid())
    providerId      String
    provider        Provider @relation(fields: [providerId], references: [id])
    bio             String?
    languages       String[]
    specialties     String[]
    basePricePerDay Int
    imageUrls       String[]
    rating          Float?   @default(0)
    totalReviews    Int      @default(0)
    isActive        Boolean  @default(true)
    address         Address? @relation(fields: [addressId], references: [id])
    addressId       String?

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
}

model Permit {
    id               String        @id @default(uuid())
    bookingItemId    String?
    bookingItem      BookingItem?  @relation(fields: [bookingItemId], references: [id])
    participantId    String?       @unique
    participant      BookingGuest? @relation(fields: [participantId], references: [id])
    status           PermitStatus  @default(REQUIRED)
    passportPhotoId  String?
    passportPhoto    Document?     @relation("PassportPhoto", fields: [passportPhotoId], references: [id])
    identityProofId  String?
    identityProof    Document?     @relation("IdentityProof", fields: [identityProofId], references: [id])
    permitDocumentId String?
    permitDocument   Document?     @relation("PermitDocument", fields: [permitDocumentId], references: [id])
    submittedAt      DateTime?
    approvedAt       DateTime?
    rejectedAt       DateTime?
    rejectionReason  String?

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

    @@index([bookingItemId])
    @@index([status])
}

model User {
    id               String    @id @default(uuid())
    email            String    @unique
    firstName        String
    lastName         String
    passwordHash     String?
    isVerified       Boolean   @default(false)
    avatarUrl        String?
    gender           Gender?
    dateOfBirth      DateTime?
    lastLogin        DateTime?
    customerId       String?
    createdAt        DateTime  @default(now()) @map("created_at")
    updatedAt        DateTime  @default(now()) @updatedAt @map("updated_at")
    oneTimePassword  String?
    oneTimeExpire    DateTime?
    resetToken       String?
    resetTokenExpire DateTime?

    provider       Provider?
    roles          UserRoleMap[]
    sessions       Session[]
    authIdentities AuthIdentity[]
    bookings       Booking[]
    reviews        Review[]
    memories       Memories[]
    bucketLists    BucketList[]
}

model UserRoleMap {
    id     String   @id @default(uuid())
    userId String
    role   UserRole
    user   User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([userId, role])
}

model AuthIdentity {
    id         String       @id @default(uuid())
    userId     String
    provider   AuthProvider
    providerId String
    user       User         @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([provider, providerId])
}

model Session {
    id           String   @id @default(uuid())
    userId       String
    refreshToken String
    expiresAt    DateTime
    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Onboarding {
    id           String         @id @default(uuid())
    providerType ProviderType[]
    email        String
    token        String         @unique
    expiresAt    DateTime
    completedAt  DateTime?
    providerId   String?
    metadata     Json?
    createdAt    DateTime       @default(now()) @map("created_at")
    updatedAt    DateTime       @default(now()) @updatedAt @map("updated_at")

    @@index([token])
    @@index([email])
}

model Provider {
    id            String           @id @default(uuid())
    name          String
    type          ProviderType[]
    verified      Boolean          @default(false)
    status        ProviderStatus   @default(PENDING)
    contactNumber String
    userId        String           @unique
    createdAt     DateTime         @default(now()) @map("created_at")
    updatedAt     DateTime         @default(now()) @updatedAt @map("updated_at")
    user          User             @relation(fields: [userId], references: [id])
    activities    Activity[]
    homestays     Homestay[]
    vehicles      Vehicle[]
    localGuides   LocalGuide[]
    payouts       ProviderPayout[]
}

model Review {
    id         String       @id @default(uuid())
    userId     String
    targetType ReviewTarget
    targetId   String
    rating     Int
    comment    String?

    bookingId String?
    booking   Booking? @relation(fields: [bookingId], references: [id])
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([userId, targetType, targetId])
}

model TourItinerary {
    id        String @id @default(uuid())
    tourId    String
    dayNumber Int
    title     String
    details   Json?

    tour Tour               @relation(fields: [tourId], references: [id], onDelete: Cascade)
    pois TourItineraryPOI[]
}

model TourItineraryPOI {
    id          String        @id @default(uuid())
    itineraryId String
    poiId       String
    order       Int
    itinerary   TourItinerary @relation(fields: [itineraryId], references: [id], onDelete: Cascade)
    poi         POI           @relation(fields: [poiId], references: [id], onDelete: Cascade)

    @@unique([itineraryId, poiId, order])
}

model Tour {
    id          String          @id @default(uuid())
    title       String
    description String
    price       Int
    duration    Int
    imageUrls   String[]
    tags        String[]
    maxCapacity Int             @default(10)
    isActive    Boolean         @default(true)
    about       String?
    included    String[]
    notIncluded String[]
    highlights  String[]
    brochure    String?
    address     Address?        @relation(fields: [addressId], references: [id])
    addressId   String?
    itinerary   TourItinerary[]
    createdAt   DateTime        @default(now()) @map("created_at")
    updatedAt   DateTime        @default(now()) @updatedAt @map("updated_at")
}

model Activity {
    id          String   @id @default(uuid())
    title       String
    description String
    price       Int
    duration    Int
    providerId  String
    provider    Provider @relation(fields: [providerId], references: [id])
    createdAt   DateTime @default(now()) @map("created_at")
    updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")
}

model Homestay {
    id          String         @id @default(uuid())
    name        String
    description String
    tags        String[]
    facilities  String[]
    imageUrls   String[]
    email       String
    phoneNumber String
    isActive    Boolean        @default(true)
    providerId  String
    provider    Provider       @relation(fields: [providerId], references: [id])
    address     Address?       @relation(fields: [addressId], references: [id])
    addressId   String?
    rooms       HomestayRoom[]
    createdAt   DateTime       @default(now()) @map("created_at")
    updatedAt   DateTime       @default(now()) @updatedAt @map("updated_at")
}

model HomestayRoom {
    id           String             @id @default(uuid())
    homestayId   String
    name         String
    capacity     Int
    basePrice    Int
    totalRooms   Int
    homestay     Homestay           @relation(fields: [homestayId], references: [id])
    availability RoomAvailability[]
}

model RoomAvailability {
    id        String       @id @default(uuid())
    roomId    String
    date      DateTime
    available Int
    room      HomestayRoom @relation(fields: [roomId], references: [id])

    @@unique([roomId, date])
}

model Destinations {
    id          String   @id @default(uuid())
    name        String
    description String
    imageUrls   String[]
    tripPrice   Int
    noOfDays    Int[]
    tags        String[]
    latitude    Float
    longitude   Float
    address     String
    createdAt   DateTime @default(now()) @map("created_at")
    updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")
}

model Booking {
    id        String        @id @default(uuid())
    userId    String
    status    BookingStatus
    source    BookingSource @default(ONLINE)
    user      User          @relation(fields: [userId], references: [id])
    items     BookingItem[]
    reviews   Review[]
    payment   Payment[]
    createdAt DateTime      @default(now()) @map("created_at")
    updatedAt DateTime      @default(now()) @updatedAt @map("updated_at")
}

model BookingItem {
    id             String         @id @default(uuid())
    bookingId      String
    productType    ProductType
    productId      String
    startDate      DateTime?
    endDate        DateTime?
    quantity       Int
    price          Int
    permitRequired Boolean        @default(false)
    booking        Booking        @relation(fields: [bookingId], references: [id], onDelete: Cascade)
    guests         BookingGuest[]
    permits        Permit[]
}

model BookingGuest {
    id            String @id @default(uuid())
    bookingItemId String

    fullName      String
    contactNumber String
    age           Int
    gender        Gender

    bookingItem BookingItem @relation(fields: [bookingItemId], references: [id], onDelete: Cascade)
    permit      Permit?

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
}

model Payment {
    id                String          @id @default(uuid())
    amount            Int
    currency          String          @default("INR")
    status            PaymentStatus
    provider          PaymentProvider
    providerOrderId   String?
    providerPaymentId String?
    notes             String?
    method            MethodEnum?
    cardToken         String?
    cardLast4         String?
    cardNetwork       String?
    cardBank          String?
    upiVpa            String?
    upiName           String?
    bankCode          String?
    bankName          String?
    nickname          String?
    bookingId         String?
    booking           Booking?        @relation(fields: [bookingId], references: [id])

    refunds Refund[]
    payouts ProviderPayout[]
    webhook WebhookEvent[]

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

    @@index([bookingId])
}

model Refund {
    id        String       @id @default(uuid())
    paymentId String
    amount    Int
    reason    String?
    status    RefundStatus
    payment   Payment      @relation(fields: [paymentId], references: [id])
    createdAt DateTime     @default(now())
}

model ProviderPayout {
    id          String       @id @default(uuid())
    providerId  String
    paymentId   String?
    amount      Int
    periodStart DateTime
    periodEnd   DateTime
    status      PayoutStatus
    provider    Provider     @relation(fields: [providerId], references: [id])
    payment     Payment?     @relation(fields: [paymentId], references: [id])
    createdAt   DateTime     @default(now()) @map("created_at")
    updatedAt   DateTime     @default(now()) @updatedAt @map("updated_at")
}

model CancellationPolicy {
    id          String      @id @default(uuid())
    productType ProductType
    productId   String
    hoursBefore Int
    refundPct   Int
    createdAt   DateTime    @default(now()) @map("created_at")
    updatedAt   DateTime    @default(now()) @updatedAt @map("updated_at")

    @@unique([productType, productId])
}

model WebhookEvent {
    id              String          @id @default(uuid())
    provider        PaymentProvider
    providerEventId String          @unique
    eventType       String
    receivedAt      DateTime        @default(now())
    signature       String?
    rawBody         Json
    processed       Boolean         @default(false)
    processedAt     DateTime?
    notes           String?
    paymentId       String?
    payment         Payment?        @relation(fields: [paymentId], references: [id], onDelete: Cascade)
    createdAt       DateTime        @default(now()) @map("created_at")
    updatedAt       DateTime        @default(now()) @updatedAt @map("updated_at")

    @@index([eventType])
    @@index([paymentId])
}

model Document {
    id         String       @id @default(uuid())
    userId     String?
    type       DocumentType
    url        String
    fileName   String?
    mimeType   String?
    size       Int?
    uploadedAt DateTime     @default(now())

    permitsAsPassport Permit[] @relation("PassportPhoto")
    permitsAsIdentity Permit[] @relation("IdentityProof")
    permitsAsDocument Permit[] @relation("PermitDocument")

    deletedAt DateTime?

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

    @@index([userId, type])
    @@index([deletedAt])
}

model FeatureFlag {
    id          String      @id @default(uuid())
    serviceType ServiceType @unique
    enabled     Boolean     @default(true)
    message     String? // Message to show when service is disabled
    createdAt   DateTime    @default(now()) @map("created_at")
    updatedAt   DateTime    @default(now()) @updatedAt @map("updated_at")

    @@index([serviceType, enabled])
}

enum DocumentType {
    PASSPORT
    ID_PROOF
    PERMIT
}

model AppBanner {
    id        String   @id @default(uuid())
    name      String
    imageUrl  String[]
    redirect  String
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
}

enum ConfigType {
    HOME_PAGE
}

model AppUiConfig {
    id        String     @id @default(uuid())
    name      String
    type      ConfigType @default(HOME_PAGE)
    uiConfig  Json
    createdAt DateTime   @default(now()) @map("created_at")
    updatedAt DateTime   @default(now()) @updatedAt @map("updated_at")
}

model Memories {
    id          String   @id @default(uuid())
    title       String
    description String?
    imageUrls   String[]
    userId      String
    user        User     @relation(fields: [userId], references: [id])
    createdAt   DateTime @default(now()) @map("created_at")
    updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")
}
